<reports_base>
    <div class="row">
        <div id="side-menu">
            <div>
                <ul class="navigation">
                    <ul>
                        <li class="active">{ window.gettext("Reports") }</li>
                    </ul>
                </ul>
            </div>
        </div>

        <div id="reports">
            <report if="{ state.page }" id="{ state.page }" showFeedback="{ showFeedback }"></report>
            <div if="{ !state.page }">
                <div class="content-wrapper">
                    <h6>{ window.gettext("Road Network Report") }</h6>
                    <div class="align-items-center d-flex report" onclick="{ selectPage }" data-id="0">
                        <span class="paper image"></span>
                        <p>{ window.gettext("Road Network Length") }</p>
                    </div>
                    <div class="align-items-center d-flex disabled report" onclick="{ selectPage }" data-id="1">
                        <span class="paper image"></span>
                        <p>{ window.gettext("Road Network Length Breakdown") } (coming soon)</p>
                    </div>
                </div>

                <div class="content-wrapper">
                    <h6>{ window.gettext("Road Condition Report") }</h6>
                    <div class="align-items-center d-flex report" onclick="{ selectPage }" data-id="2">
                        <span class="paper image"></span>
                        <p>{ window.gettext("Surface Condition (SDI)") }</p>
                    </div>
                    <div class="align-items-center d-flex disabled report" onclick="{ selectPage }" data-id="3">
                        <span class="paper image"></span>
                        <p>{ window.gettext("IRI Roughness") } (coming soon)</p>
                    </div>
                </div>

                <div class="content-wrapper">
                    <h6>{ window.gettext("Road Network Reports by Road Class") }</h6>
                    <div class="align-items-center d-flex report" onclick="{ selectPage }" data-id="4">
                        <span class="paper image"></span>
                        <p>{ window.gettext("Road Network Length - National Class") }</p>
                    </div>
                    <div class="align-items-center d-flex report" onclick="{ selectPage }" data-id="5">
                        <span class="paper image"></span>
                        <p>{ window.gettext("Road Network Length - Municipal Class") }</p>
                    </div>
                    <div class="align-items-center d-flex report" onclick="{ selectPage }" data-id="6">
                        <span class="paper image"></span>
                        <p>{ window.gettext("Road Network Length - Rural Class") }</p>
                    </div>
                    <div class="align-items-center d-flex report" onclick="{ selectPage }" data-id="7">
                        <span class="paper image"></span>
                        <p>{ window.gettext("Road Network Length - Highway Class") }</p>
                    </div>
                    <div class="align-items-center d-flex report" onclick="{ selectPage }" data-id="8">
                        <span class="paper image"></span>
                        <p>{ window.gettext("Road Network Length - Urban Class") }</p>
                    </div>
                </div>
            </div>
            <footer>
                <small>República Democrática de Timor-Leste / Ministério  das  Obras Públicas</small>
                <small>{ window.gettext("Created by Catalpa International") }</small>
            </footer>
        </div>
    </div>

    <feedback_banner if="{ state.showFeedback }"
        close="{ closeFeedback }"
        successMessage="{ window.gettext('Report successfully created') }"
        errorMessage="{ window.gettext('Something went wrong') }"
        error="{ state.error }">
    </feedback_banner>

    <loading></loading>

    <script>
        import Feedback_Banner from './feedback_banner.riot.html';
        import Loading from './loading.riot.html';
        import Report from './report.riot.html';

        export default {
            state: {
                showFeedback: false,
                error: false,
                page: "",
            },
            components: {
                Feedback_Banner, Loading, Report,
            },
            onBeforeMount(props, state) {
                state.page = props.page;
                window.addEventListener("hashchange", this.hashCheck);
                window.goBack = () => window.location.hash = "#";
            },
            onBeforeUnmount(props, state) {
                window.removeEventListener("hashchange", this.hashCheck);
                window.goBack = () => {};
            },
            hashCheck() {
                const reportHash = /#reports\/(\d?)/.exec(location.hash);

                if (reportHash) {
                    this.update({
                        page: reportHash[1],
                    });
                }
            },
            selectPage(e) {
                const reportId = e.currentTarget.dataset.id;

                window.location.hash = `#reports/${reportId}`;
            },
            showFeedback(error) {
                this.update({
                    showFeedback: true,
                    error: error,
                });
                setTimeout(() => this.closeFeedback(), 2000);
            },
            closeFeedback() {
                const feedback = document.getElementsByClassName("slide-in").item(0);

                if (feedback) {
                    feedback.classList.add("slide-out");
                    setTimeout(() => {
                        feedback.classList.remove("slide-out");
                        this.update({ showFeedback: false });
                    }, 300);
                }
            },
        }
    </script>
</reports_base>
