import re
import sys
import fileinput

# TODO: improve this regexp - will only catch gettext('String') or gettext("String") at the moment
# Should maybe be tolerant towards other string notations
# also investigate multiline translations
prog = re.compile(r"""gettext\('[^']+'\)|gettext\("[^"]+"\)""")


def mine_gettext(line):
    """ Extract all get text calls from riot tags, in html or script
    globs: an array of glob style paths to read riot files from
    returns: an array of lines containing gettext calls
    """
    return prog.findall(line)


if __name__ == "__main__":
    sys.stdout.write("/* global gettext */\n")
    sys.stdout.write(
        "/* This file is an autogenerated collation of gettext calls in other files */\n"
    )
    sys.stdout.write(
        "/* Allowing django makemessages to pick up gettext calls in riot markup */\n"
    )
    for line in fileinput.input():
        sys.stdout.writelines(["{};\n".format(g) for g in mine_gettext(line)])
